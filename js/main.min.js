function Bullet(t){this.type=t,this.x=0,this.y=0,this.iSpeed=2*this.type,this.rotate=0,this.move()}var BULLET_SIZE=[null,{x:86,y:0,w:24,h:26},{x:62,y:0,w:25,h:29},{x:30,y:0,w:31,h:35},{x:32,y:35,w:27,h:31},{x:30,y:82,w:29,h:33},{x:0,y:82,w:30,h:34},{x:0,y:0,w:30,h:44}];Bullet.prototype.draw=function(t){var e=BULLET_SIZE[this.type].w,h=BULLET_SIZE[this.type].h,i=BULLET_SIZE[this.type].x,s=BULLET_SIZE[this.type].y;t.save(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),t.drawImage(JSON.bullet,i,s,e,h,-e/2,-h/2,e,h),t.restore()},Bullet.prototype.move=function(){var t=this;setInterval(function(){t.x+=t.iSpeed*Math.sin(d2a(t.rotate)),t.y-=t.iSpeed*Math.cos(d2a(t.rotate))},16)};
function Cannon(t){this.type=t,this.x=431,this.y=570,this.rotate=0,this.cur=0,this.time=null}var CANNON_SIZE=[null,{w:74,h:74},{w:74,h:76},{w:74,h:76},{w:74,h:83},{w:74,h:85},{w:74,h:90},{w:74,h:94}];Cannon.prototype.draw=function(t){var n=CANNON_SIZE[this.type].w,e=CANNON_SIZE[this.type].h;t.save(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),t.drawImage(JSON["cannon"+this.type],0,e*this.cur,n,e,-n/2,-e/2,n,e),t.restore()},Cannon.prototype.emitChange=function(){var t=this;clearInterval(this.time),this.time=setInterval(function(){t.cur++,5==t.cur&&(t.cur=0,clearInterval(t.time))},16)};
function CoinAni(t){this.type=t,this.x=0,this.y=0,this.cur=0,this.move()}CoinAni.prototype.draw=function(t){t.save(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),1==this.type||2==this.type||3==this.type?t.drawImage(JSON.coinAni1,0,60*this.cur,60,60,-30,-30,60,60):4!=this.type&&5!=this.type&&6!=this.type&&7!=this.type||t.drawImage(JSON.coinAni2,0,60*this.cur,60,60,-30,-30,60,60),t.restore()},CoinAni.prototype.move=function(){var t=this;setInterval(function(){t.x+=(0-t.x)/10,t.y+=(650-t.y)/10,t.cur++,10==t.cur&&(t.cur=0)},30)};
function rnd(n,t){return Math.floor(n+Math.random()*(t-n))}function d2a(n){return n*Math.PI/180}function a2d(n){return 180*n/Math.PI}function loadImage(n,t){for(var a=0,r=0;r<n.length;r++){var o=new Image;o.src="img/"+n[r]+".png",function(r){o.onload=function(){JSON[n[r]]=this,a++,a==n.length&&t&&t()}}(r)}}var JSON={};
function DieFish(t){this.type=t,this.x=0,this.y=0,this.rotate=0,this.cur=0}var FISH_SIZE=[null,{w:55,h:37,collR:17},{w:78,h:64,collR:24},{w:72,h:56,collR:20},{w:77,h:59,collR:22},{w:107,h:122,collR:29}];DieFish.prototype.draw=function(t){var i=FISH_SIZE[this.type].w,h=FISH_SIZE[this.type].h;t.save(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),this.rotate>90&&this.rotate<270&&t.scale(1,-1),t.drawImage(JSON["fish"+this.type],0,h*(this.cur+4),i,h,-i/2,-h/2,i,h),t.restore()},DieFish.prototype.move=function(){var t=this;setInterval(function(){t.cur++,4==t.cur&&(t.cur=0)},100)};
function Fish(t){this.type=t,this.x=0,this.y=0,this.cur=0,this.iSpeed=1,this.rotate=0,this.collR=FISH_SIZE[this.type].collR,this.move()}var FISH_SIZE=[null,{w:55,h:37,collR:17},{w:78,h:64,collR:24},{w:72,h:56,collR:20},{w:77,h:59,collR:22},{w:107,h:122,collR:29}];Fish.prototype.move=function(){var t=this;setInterval(function(){t.cur++,4==t.cur&&(t.cur=0)},200),setInterval(function(){t.x+=t.iSpeed*Math.cos(d2a(t.rotate)),t.y+=t.iSpeed*Math.sin(d2a(t.rotate))},16)},Fish.prototype.draw=function(t){var i=FISH_SIZE[this.type].w,s=FISH_SIZE[this.type].h;t.save(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),this.rotate>90&&this.rotate<270&&t.scale(1,-1),t.drawImage(JSON["fish"+this.type],0,s*this.cur,i,s,-i/2,-s/2,i,s),t.restore()},Fish.prototype.isIn=function(t,i){var s=this.x-t,h=this.y-i,e=Math.sqrt(s*s+h*h);return e<this.collR};
document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("c1"),t=e.getContext("2d"),r=50,n=.05,a=[-r,r];loadImage(resource,function(){var o=[],h=[],i=[],d=[],l=[],s=new Cannon(7);setInterval(function(){t.clearRect(0,0,e.width,e.height),t.drawImage(JSON.bottom,0,0,765,70,0,532,765,70),s.draw(t);for(var f=0;f<h.length;f++)h[f].draw(t);for(var f=0;f<h.length;f++)(h[f].x<-r||h[f].x>r+e.width||h[f].y<-r||h.y>r+e.height)&&(h.splice(f,1),f--);if(Math.random()<n)if(a.sort(function(){return Math.random()-.5}),a[0]<0){var c=new Fish(rnd(1,6));c.x=0-r,c.y=rnd(r,e.height-r),c.rotate=rnd(-45,45),o.push(c)}else{var c=new Fish(rnd(1,6));c.x=e.width+r,c.y=rnd(r,e.height-r),c.rotate=rnd(135,225),o.push(c)}for(var f=0;f<o.length;f++)o[f].draw(t);for(var f=0;f<o.length;f++)(o[f].x<-r||o[f].x>r+e.width||o[f].y<-r||o.y>r+e.height)&&(o.splice(f,1),f--);for(var f=0;f<i.length;f++)i[f].draw(t);for(var f=0;f<d.length;f++)d[f].draw(t);for(var f=0;f<l.length;f++)l[f].draw(t),l[f].scale+=.01,l[f].scale>1.2&&(l.splice(f,1),f--);for(var f=0;f<o.length;f++)for(var v=0;v<h.length;v++)if(o[f].isIn(h[v].x,h[v].y)){var g=o[f].x,u=o[f].y,w=o[f].rotate,y=o[f].type;o.splice(f,1),f--,h.splice(v,1),v--;var x=new DieFish(y);x.x=g,x.y=u,x.rotate=w,i.push(x),setTimeout(function(){i.shift();var e=new CoinAni(y);e.x=g,e.y=u,d.push(e)},500);var p=new Web(y);p.x=g,p.y=u,l.push(p)}},16),e.onclick=function(t){var r=t.clientX-e.offsetLeft-s.x,n=s.y-(t.clientY-e.offsetTop),a=90-a2d(Math.atan2(n,r));s.rotate=a,s.emitChange();var o=new Bullet(s.type);o.x=s.x,o.y=s.y,o.rotate=s.rotate,h.push(o)}})},!1);
var resource=["fish1","fish2","fish3","fish4","fish5","bottom","cannon1","cannon2","cannon3","cannon4","cannon5","cannon6","cannon7","bullet","coinAni1","coinAni2","web"];
function Web(t){this.type=t,this.x=0,this.y=0,this.scale=1}var WEB_SIZE=[null,{x:333,y:374,w:88,h:86},{x:15,y:414,w:109,h:108},{x:178,y:370,w:127,h:125},{x:255,y:196,w:147,h:145},{x:3,y:245,w:161,h:153},{x:242,y:2,w:179,h:180},{x:22,y:21,w:200,h:201}];Web.prototype.draw=function(t){var h=WEB_SIZE[this.type].x,s=WEB_SIZE[this.type].y,e=WEB_SIZE[this.type].w,y=WEB_SIZE[this.type].h;t.save(),t.translate(this.x,this.y),t.scale(this.scale,this.scale),t.drawImage(JSON.web,h,s,e,y,-e/2,-y/2,e,y),t.restore()};